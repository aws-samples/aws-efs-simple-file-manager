{
  "Parameters": {
    "DeploymentPackageBucket": {
      "Type": "String",
      "Description": "Bucket that contains the dataplane deployment package"
    },
    "DeploymentPackageKey": {
      "Type": "String",
      "Description": "S3 Key of the dataplane deployment package"
    },
    "botoConfig": {
      "Type": "String",
      "Description": "Botocore config"
    },
    "ApiHandlerIamRole": {
      "Type": "String",
      "Description": "Arn of the API Handler IAM Role"
    },
    "stackPrefix": {
      "Type": "String",
      "Description": "Prefix of the main Stack to use for manager resource Stacks"
    }
  },
  "Resources": {
    "APIHandler": {
      "Properties": {
        "Runtime": "python3.8",
        "Role": {"Ref": "ApiHandlerIamRole"},
        "Environment": {
          "Variables": {
            "botoConfig": {"Ref": "botoConfig"},
            "stackPrefix": {"Ref": "stackPrefix"}
          }
        },
        "CodeUri": {"Bucket": {"Ref": "DeploymentPackageBucket"}, "Key": {"Ref": "DeploymentPackageKey"}}
      }
    },
    "RestAPI": {
      "Properties": {
        "AccessLogSetting": {
          "DestinationArn": {
            "Fn::Sub": "arn:aws:logs:eu-west-1:${AWS::AccountId}:log-group:/aws/apigateway/${stackPrefix}-EFSFileManagerAPI-AccessLogs:*"
          },
          "Format": "{\"requestId\":\"$context.requestId\", \"ip\": \"$context.identity.sourceIp\", \"caller\":\"$context.identity.caller\", \"user\":\"$context.identity.user\", \"requestTime\":\"$context.requestTime\", \"httpMethod\":\"$context.httpMethod\", \"resourcePath\":\"$context.resourcePath\", \"status\":\"$context.status\", \"protocol\":\"$context.protocol\" \"responseLength\":\"$context.responseLength\"}"
        },
        "TracingEnabled": true
    }
  }
}
}